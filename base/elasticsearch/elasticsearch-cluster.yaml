apiVersion: elasticsearch.k8s.elastic.co/v1
kind: Elasticsearch
metadata:
  name: es-cluster
  namespace: efkstack
spec:
  version: 8.12.2
  http: # â¬…ï¸ ì´ ë¶€ë¶„ì„ ì¶”ê°€í•©ë‹ˆë‹¤.
    service:
      spec:
        type: LoadBalancer # â¬…ï¸ ì„œë¹„ìŠ¤ íƒ€ì…ì„ LoadBalancerë¡œ ì§€ì •
  nodeSets:
  - name: default
    count: 2
    config:
      node.store.allow_mmap: false
    # --- â–¼â–¼â–¼ ì´ ë¶€ë¶„ì„ ì¶”ê°€ â–¼â–¼â–¼ ---
  #auth:
    #fileRealm:
    #- secretName: elastic-password # â˜…â˜…â˜… 1ë‹¨ê³„ì—ì„œ ë§Œë“  Secretì˜ ì´ë¦„ì„ ì—¬ê¸°ì— ì ì–´ì¤ë‹ˆë‹¤.
  # --- â–²â–²â–² ì—¬ê¸°ê¹Œì§€ ì¶”ê°€ â–²â–²â–² ---
    podTemplate:
      spec:
        # S3 í”ŒëŸ¬ê·¸ì¸ ì„¤ì¹˜ - Init Container
        initContainers:
        - name: install-plugins
          command: ["sh", "-c", "bin/elasticsearch-plugin install --batch repository-s3"]
        containers:
        - name: elasticsearch
          resources:
            requests:
              memory: 2Gi
              cpu: 1
            limits:
              memory: 2Gi
              cpu: 1
  # --- ğŸ‘‡ ì—¬ê¸°ê°€ í•µì‹¬ì…ë‹ˆë‹¤! ---
  # Operatorì—ê²Œ Secretì„ Keystoreì— ì•ˆì „í•˜ê²Œ ì¶”ê°€í•˜ë„ë¡ ì§€ì‹œí•©ë‹ˆë‹¤.
  secureSettings:
  - secretName: aws-credentials