# base/kafka-connect/es-sink-connector.yaml
apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaConnector
metadata:
  name: es-sink-connector # ì»¤ë„¥í„°ì˜ ì´ë¦„
  namespace: efkstack
  labels:
    # ì´ ë¼ë²¨ì„ í†µí•´ Strimziê°€ ì–´ë–¤ KafkaConnect í´ëŸ¬ìŠ¤í„°ë¥¼ íƒ€ê²Ÿìœ¼ë¡œ í• ì§€ ê²°ì •
    strimzi.io/cluster: "kafka-connect" 
spec:
  class: io.confluent.connect.elasticsearch.ElasticsearchSinkConnector
  tasksMax: 1
  # JSONì˜ config ì„¹ì…˜ ë‚´ìš©ì„ ê·¸ëŒ€ë¡œ ê°€ì ¸ì˜´
  config:
    topics: "system-auth-topic,service-topic,system-kmsg-topic"
    connection.url: "https://es-cluster-es-http:9200"
    connection.username: "elastic"
    
    # [ë³´ì•ˆ ê°•í™”] ë¹„ë°€ë²ˆí˜¸ë¥¼ Secretì—ì„œ ì•ˆì „í•˜ê²Œ ê°€ì ¸ì˜¤ê¸°
    connection.password: "${env:ES_CONNECTION_PASSWORD}"
    # --- ğŸ’¡ ì—¬ê¸°ì— SSL ì„¤ì •ì„ ì¶”ê°€í•©ë‹ˆë‹¤ ---
    es.net.ssl: true
    es.net.ssl.ca: "${env:ES_SSL_CA_CERT}"

    type.name: "_doc"
    key.ignore: "true"
    schema.ignore: "true"
    
    # --- ì„±ëŠ¥ ìµœì í™” ì„¤ì • ---
    flush.timeout.ms: 60000
    batch.size: 1000
    max.in.flight.requests: 1
    max.buffered.records: 5000
    linger.ms: 1000
    connection.timeout.ms: 30000
    read.timeout.ms: 30000